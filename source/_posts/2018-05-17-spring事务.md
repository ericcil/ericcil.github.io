---
title: spring事务
date: 2018-05-17 21:38:34
tags:
category:
---

###


<!-- more -->

spring事务传播性质

内层事务传播性质

Propagation.REQUIRED：

Propagation.REQUIRES_NEW：
内部方法新建一个事务，
内层事务独立于外层事务，在内层事务外围包裹try catch，就不会影响到外层事务正常提交
当外层先修改表A的数据a，随后进入内层事务，修改表A的数据a，则一定会抛出异常
java.sql.SQLException: Lock wait timeout exceeded; try restarting transaction

外层发生异常，内层不会回滚

propagation=Propagation.SUPPORTS
内层与外层在同一事务内
内层抛出异常，即使在内层事务外围包裹try catch，也会影响外层事务
org.springframework.transaction.UnexpectedRollbackException: Transaction rolled back because it has been marked as rollback-only

Propagation.NESTED:
外层无事务，内层自身开启一个事务
外层有事务，内层自身为一个嵌套事务

内层事务独立于外层事务，在内层事务外围包裹try catch，就不会影响到外层事务正常提交
外层发生异常会回退内层事务